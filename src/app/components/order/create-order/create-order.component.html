<div class="container p-5">
    <div class="row">
        <!-- Filtro de empresas -->
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Filtrar Empresas</h5>
                    <div class="form-group">
                        <label for="searchInput">Buscar empresa:</label>
                        <div class="input-group">
                            <input id="searchInput" [(ngModel)]="searchTerm" (input)="filterCompanies()"
                                class="form-control">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div *ngFor="let company of filteredCompanies">
                            <label class="d-block">
                                <input type="checkbox" [disabled]="this.disabled_checkbox"
                                    [ngModel]="company.isSelected" (click)="updateSelection(company.nit_company)">
                                {{ company.name_company }}
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <!-- Lista de productos -->

        

        <div class="col-md-9">
            <div class="" style="height: 500px; display: flex; flex-direction: column; justify-content: space-between;">
                <div *ngIf="indexPage === 1">
                    <div class="all d-flex flex-md-wrap gap-2 overflow-auto" style=" height: 450px;">
                        <div (click)="viewProductModal(product.id_product)" data-bs-toggle="modal" data-bs-target="#productModal" class="card d-flex flex-column" *ngFor="let product of products" style="width: 30%; height: 420px;">
            
                            <div class="d-flex align-items-center">
                                <img appBrokenImage loading="lazy" [src]="product.image_product" alt="{{ product?.name_product }}"
                                    class="img-fluid p-5">
                            </div>
            
                            <div class="p-2" style="">
                                <h1 style="font-size: 18px;"><strong>{{ product?.name_product }}</strong></h1>
                                <div class="d-flex justify-content-between mb-2 p-2">
                                    <p style="font-size: 14px; color: gray;">Stock {{ product?.purchase_price_product }}</p>
                                    <button class="btn btn-outline-danger" (click)="removeProduct(product)"
                                    [disabled]="!(product.add_product)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                                        <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
                                      </svg> </button>
                                </div>
            
                                <div class="options d-flex justify-content-center gap-2">
            
                                    <button (click)="decreaseProduct(product)" class="btn btn-sm btn-outline-warning">-</button>
                                    <button class="CartBtn" (click)="addProduct(product)"
                                    [disabled]="product.product_quantity === 0">
                                        <span class="IconContainer">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"
                                                fill="rgb(17, 17, 17)" class="cart">
                                                <path
                                                    d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z">
                                                </path>
                                            </svg>
                                        </span>
                                        <p class="text">Agrgar {{product.product_quantity}}</p>
                                    </button>
            
                                    <button (click)="increaseProduct(product)" class="btn btn-sm btn-outline-success">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="indexPage === 2">
                    <h2>Providers</h2>

                    <div *ngFor="let provider of providers">
                        <div class="card">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div class="div">
                                    <!-- <p>{{provider.document_provider}}</p> -->
                                    <p><strong>{{provider.name_provider}} {{provider.last_name_provider}}</strong> </p>
                                </div>
                                <div>
                                    <input
                                        (click)="getData(provider.document_provider, provider.name_provider, provider.last_name_provider)"
                                        class="form-check-input" style="cursor: pointer;" type="checkbox" value=""
                                        id="flexCheckIndeterminate">
                                    <label class="form-check-label" for="flexCheckIndeterminate">
                                        Confirmar
                                    </label>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div *ngIf="indexPage === 3">
                    <h2>Confirm</h2>
                    <div style="max-height: 400px; overflow-y: auto; background-color: aqua;">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">Imagen</th>
                                    <th scope="col">Nombre del Producto</th>
                                    <th scope="col">Precio de Compra</th>
                                    <th scope="col">Cantidad Pedida</th>
                                    <th scope="col">Stock</th>
                                    <!-- <th scope="col">Trabajador</th> -->
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let product of data_order.products">
                                    <td>
                                        <img appBrokenImage loading="lazy" [src]="product.image_product"
                                            alt="{{ product?.name_product }}" class="product-image">
                                    </td>
                                    <td>{{ product?.name_product }}</td>
                                    <td>{{ product?.purchase_price_product }}</td>
                                    <td>{{ product?.product_quantity}}</td>
                                    <td>{{ product?.stock_product}}</td>
                                    <!-- <td>{{ data_order?.name_provider}} {{ data_order?.last_name_provider}}</td> -->
                                </tr>
                            </tbody>


                        </table>
                        <div style="display: flex; align-items: end;">
                            <th scope="col">Trabajador</th>
                            <td>{{ data_order?.name_provider}} {{ data_order?.last_name_provider}}</td>
                        </div>
                    </div>
                </div>
                <div class="div"
                    style="display: flex; flex-direction: column; align-items: end; border-top: 2px gray solid; padding-top: 5px;">
                    <div class="div">
                        <p><strong>Total:</strong> ${{total}} COP</p>
                    </div>
                    <div class="buttons" style="display: flex; gap: 10px;">
                        <button class="btn btn-outline-danger" [disabled]="isData" (click)="cancel()">Cancelar</button>
                        <button class="btn btn-outline-success" *ngIf="indexPage !== 3" [disabled]="isData"
                            (click)="nextPage()">Siguiente</button>
                        <button class="btn btn-outline-success" (click)="confirm()"
                            *ngIf="indexPage === 3">Confirmar</button>
                        <button class="btn btn-outline-primary" (click)="editOrder()"
                            *ngIf="indexPage === 3">Editar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="productModal">Detalle del Producto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- <app-view-product [productModal]="product_modal"></app-view-product> -->
                        <app-view-product [productModal]="product_modal"></app-view-product>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>